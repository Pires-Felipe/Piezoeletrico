<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Tensão Piezoelétrica</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; }
        .chart-container { width: calc(50% - 10px); min-height: 300px; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; }
        .stats-container { width: 100%; border: 1px solid #ccc; padding: 10px; box-sizing: border-box; }
    </style>
</head>
<body>
    <h1>Dashboard de Tensão Piezoelétrica</h1>
    <div class="container">
        <div class="chart-container">
            <canvas id="tensaoChart"></canvas>
        </div>
        <div class="stats-container">
            <h2>Estatísticas</h2>
            <p><strong>Valor Atual:</strong> <span id="valorAtual"></span></p>
            <p><strong>Média:</strong> <span id="media"></span></p>
            <p><strong>Máximo:</strong> <span id="maximo"></span></p>
            <p><strong>Mínimo:</strong> <span id="minimo"></span></p>
        </div>
        </div>

    <script>
        const ctxTensao = document.getElementById('tensaoChart').getContext('2d');
        let tensaoChart;
        let dadosTensao = [];
        let labelsTempo = [];

        function atualizarDashboard() {
            fetch('/dados')
                .then(response => response.json())
                .then(data => {
                    dadosTensao = data.dados;
                    labelsTempo = Array.from(Array(dadosTensao.length).keys()); // Simples labels de tempo

                    document.getElementById('valorAtual').textContent = dadosTensao[dadosTensao.length - 1] !== undefined ? dadosTensao[dadosTensao.length - 1].toFixed(2) : 'N/A';
                    document.getElementById('media').textContent = dadosTensao.length > 0 ? (dadosTensao.reduce((a, b) => a + b, 0) / dadosTensao.length).toFixed(2) : 'N/A';
                    document.getElementById('maximo').textContent = dadosTensao.length > 0 ? Math.max(...dadosTensao).toFixed(2) : 'N/A';
                    document.getElementById('minimo').textContent = dadosTensao.length > 0 ? Math.min(...dadosTensao).toFixed(2) : 'N/A';

                    if (tensaoChart) {
                        tensaoChart.destroy();
                    }

                    tensaoChart = new Chart(ctxTensao, {
                        type: 'line',
                        data: {
                            labels: labelsTempo,
                            datasets: [{
                                label: 'Tensão (Volts)',
                                data: dadosTensao,
                                borderColor: 'rgb(75, 192, 192)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                })
                .catch(error => console.error('Erro ao obter dados:', error));
        }

        setInterval(atualizarDashboard, 1000); // Atualizar a cada 1 segundo
    </script>
</body>
</html>
